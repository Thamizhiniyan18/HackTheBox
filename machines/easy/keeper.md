---
description: Keeper writeup by Thamizhiniyan C S
---

# Keeper

## Overview

Greetings everyone,

In this write-up, we will tackle Keeper from HackTheBox.

Machine link: [Keeper](https://app.hackthebox.com/machines/Keeper)

Difficulty Level: Easy

Let's Begin üôå

Firstly, connect to the HTB server using the OpenVPN configuration file generated by HTB.  [Click Here](https://help.hackthebox.com/en/articles/5185687-introduction-to-lab-access) to learn more about how to connect to VPN and access the boxes.

Once connected to the VPN service, click on "Join Machine" to access the machine's IP.

Upon joining the machine, you will be able to view the IP address of the target machine.

***

## Reconnaissance

### Rustscan

`rustscan -a <TARGET_IP> -- -A -T4 -v -Pn`

<figure><img src="../../.gitbook/assets/Untitled (25).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/Untitled 1 (26).png" alt=""><figcaption></figcaption></figure>

### Results

From the results of the scan, we can see that two ports are open:

| Ports | Services | Version       |
| ----- | -------- | ------------- |
| 22    | SSH      | OpenSSH 8.9p1 |
| 80    | HTTP     | nginx 1.18.0  |

***

## Information Gathering - Port 80

Next I checked the `nginx` server running on port 80.

<figure><img src="../../.gitbook/assets/Untitled 2 (25).png" alt=""><figcaption></figcaption></figure>

When I visited the website, I got the above link, the link redirected to `tickets.keeper.htb`.

<figure><img src="../../.gitbook/assets/Untitled 3 (28).png" alt=""><figcaption></figcaption></figure>

You can see the above error on redirection. To view this site, we have to add this domain referring the target IP address in `/etc/hosts` file in our local machine.

Open the `/etc/hosts` file with your favourite text editor and add the following: `10.10.11.227 tickets.keeper.htb` to the `hosts` file.

<figure><img src="../../.gitbook/assets/Untitled 4 (24).png" alt=""><figcaption></figcaption></figure>

Now revisit the website and refresh, you can see the following site:

<figure><img src="../../.gitbook/assets/Untitled 5 (24).png" alt=""><figcaption></figcaption></figure>

This is a Request Tracker web-server. On searching about Request Tracker on google, looking out for default credentials, found this:

<figure><img src="../../.gitbook/assets/Untitled 6 (25).png" alt=""><figcaption></figcaption></figure>

***

## Initial Access

So, I tried the above mentioned credentials `root:password`, it worked:

<figure><img src="../../.gitbook/assets/Untitled 7 (20).png" alt=""><figcaption></figcaption></figure>

After surfing the application for sometime, In the Admin > Users tab, I found another user:

<figure><img src="../../.gitbook/assets/Untitled 8 (20).png" alt=""><figcaption></figcaption></figure>

On viewing the details of the user, I found the password.

<figure><img src="../../.gitbook/assets/Untitled 9 (19).png" alt=""><figcaption></figcaption></figure>

So we found another user with the following credential: `lnorgaard:Welcome2023!`

I logged in with the above found credential.

<figure><img src="../../.gitbook/assets/Untitled 10 (19).png" alt=""><figcaption></figcaption></figure>

The dashboard was in Danish version, so I used Google Translate to translate the page to English. There was a ticket in queue, which stated ‚ÄúIssue with Keepass client on Windows‚Äù. On viewing the details of the ticket, it was mentioned that the crash file is attached as an attachment.

<figure><img src="../../.gitbook/assets/Untitled 11 (18).png" alt=""><figcaption></figcaption></figure>

But no attachment was found. After investigating for sometime, I noted the ticket ID and re logged in as the root user.

<figure><img src="../../.gitbook/assets/Untitled 12 (18).png" alt=""><figcaption></figcaption></figure>

As root user, I tried to search for the ticket with the ID that I noted.

<figure><img src="../../.gitbook/assets/Untitled 13 (18).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/Untitled 14 (17).png" alt=""><figcaption></figcaption></figure>

From the history section of the results, we can devise that the user `lnorgaard` has downloaded and stored the crash file in his home directory.

So I logged in to the target via SSH using the credential: `lnorgaard:Welcome2023!`

<figure><img src="../../.gitbook/assets/Untitled 15 (15).png" alt=""><figcaption></figcaption></figure>

***

## Getting the User Flag

After logging in, I checked the home directory.

<figure><img src="../../.gitbook/assets/Untitled 16 (14).png" alt=""><figcaption></figcaption></figure>

***

## Escalating Privileges

In the home directory, I found the crash file as well as the user flag.

I started a simple HTTP server using python on the target machine and downloaded the crash file to the local machine to analyse.

<figure><img src="../../.gitbook/assets/Untitled 17 (14).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/Untitled 18 (14).png" alt=""><figcaption></figcaption></figure>

Next I extracted the files using `unzip`.

<figure><img src="../../.gitbook/assets/Untitled 19 (11).png" alt=""><figcaption></figcaption></figure>

Two files got extracted from the zip, one is a memory dump file and another one is a keepass database.

<figure><img src="../../.gitbook/assets/Untitled 20 (12).png" alt=""><figcaption></figcaption></figure>

On searching about the keepass dump file on google, I found that it is vulnerable to `CVE-2023-32784`, i.e., there is a possibility that the masterkey for the keepass might be recorded in a crash report file. On searching more I found the following page:

{% embed url="https://github.com/matro7sh/keepass-dump-masterkey" %}

I downloaded the script from the above mentioned github page using `wget`.

`wget https://raw.githubusercontent.com/CMEPW/keepass-dump-masterkey/main/poc.py`

<figure><img src="../../.gitbook/assets/Untitled 21 (10).png" alt=""><figcaption></figcaption></figure>

Next I ran the script using the command:

`python3 poc.py -d KeePassDumpFull.dmp`

<figure><img src="../../.gitbook/assets/Untitled 22 (9).png" alt=""><figcaption></figcaption></figure>

From the results of the script, we got a possible list of passwords. Mostly the first 2 characters are differing in the list. So I tried searching on google with the balance two words and found the following:

<figure><img src="../../.gitbook/assets/Untitled 23 (8).png" alt=""><figcaption></figcaption></figure>

It seems like it is a Danish Delight. Let‚Äôs try `r√∏dgr√∏d med fl√∏de` as the master key. First to view the contents of a keepass database, you need keepass installed on your system. You can download and install keepass for your respected system from [https://keepass.info/download.html](https://keepass.info/download.html)

Next to open the database, type the following command: `keepass2 passcodes.kdbx`

<figure><img src="../../.gitbook/assets/Untitled 24 (9).png" alt=""><figcaption></figcaption></figure>

On the pop up screen enter the master key and hit ok.

<figure><img src="../../.gitbook/assets/Untitled 25 (8).png" alt=""><figcaption></figcaption></figure>

It worked:

<figure><img src="../../.gitbook/assets/Untitled 26 (7).png" alt=""><figcaption></figcaption></figure>

There was two entries. The entry with the title `keeper.htb` has the contents of a putty key file in the notes section:

<figure><img src="../../.gitbook/assets/Untitled 27 (7).png" alt=""><figcaption></figcaption></figure>

Copy this content and save it a putty key file (ppk). You can copy the notes by the following method:

<figure><img src="../../.gitbook/assets/Untitled 28 (6).png" alt=""><figcaption></figcaption></figure>

Now copy the contents of the notes and save it in a ppk file.

<figure><img src="../../.gitbook/assets/Untitled 29 (5).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/Untitled 30 (5).png" alt=""><figcaption></figcaption></figure>

Now from the putty key that we got, we can generate a SSH Key using `puttygen`.

Command: `puttygen puttykey.ppk -O private-openssh -o idrsa.pem`

<figure><img src="../../.gitbook/assets/Untitled 31 (4).png" alt=""><figcaption></figcaption></figure>

Next using the generated key file, login via SSH to the target:

<figure><img src="../../.gitbook/assets/Untitled 32 (5).png" alt=""><figcaption></figcaption></figure>

Now we got access as root.

***

## Getting the Root Flag

<figure><img src="../../.gitbook/assets/Untitled 33 (5).png" alt=""><figcaption></figcaption></figure>

And we have successfully found the root flag.

Thank You‚Ä¶‚Ä¶‚Ä¶..
